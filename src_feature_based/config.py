# src_feature_based/config.py
"""
Central configuration file for the Handcrafted Feature-Based pipeline.
"""
import os

# --- Path Configuration ---
PROJECT_ROOT = os.path.abspath(os.path.join(os.path.dirname(__file__), '..'))
# The top-level directory containing all raw data subfolders.
#RAW_DATA_ROOT_LOCAL = os.path.join(PROJECT_ROOT, "datasets")

RAW_DATA_ROOT = '/Volumes/One_Touch/Airflow-rate-prediction/datasets'
# Path to the parent directory containing corresponding .npy mask files
RAW_MASK_PARENT_DIR = os.path.join(PROJECT_ROOT, "Output_SAM/datasets")
# Path to the ground truth airflow data. We'll look for it in the root.
GROUND_TRUTH_CSV_PATH = os.path.join(PROJECT_ROOT, "airflow_ground_truth_combined.csv")
# for single material only
#GROUND_TRUTH_CSV_PATH = os.path.join(PROJECT_ROOT, "airflow_ground_truth_hardyboard.csv")
# Output directory for all generated files for this pipeline.
OUTPUT_DIR = os.path.join(PROJECT_ROOT, "output_feature_based")

# --- Dataset Creation Parameters ---
# To add a new dataset:
# 1. Add a unique key (e.g., "new_material_date").
# 2. Set 'material' to a simple, lowercase string (e.g., "new_material").
#    This MUST match the name generated by the create_ground_truth_labels.py script.
# 3. Set 'dataset_subfolder' to the exact folder name inside RAW_DATA_ROOT.
DATASET_CONFIGS = {
    "gypsum_0716": {"material": "gypsum", "dataset_subfolder": "Fluke_Gypsum_07162025_noshutter"},
    "gypsum_0725": {"material": "gypsum", "dataset_subfolder": "Fluke_Gypsum_07252025_noshutter"},
    "gypsum_0729": {"material": "gypsum", "dataset_subfolder": "Fluke_Gypsum_07292025_noshutter"},
    # "brick_cladding_0616": {"material": "brick_cladding", "dataset_subfolder": "Fluke_BrickCladding_2holes_0616_2025_noshutter"},
    # "brick_cladding_0805": {"material": "brick_cladding", "dataset_subfolder": "Fluke_BrickCladding_2holes_0805_2025_noshutter"},
    # "brick_cladding_0808": {"material": "brick_cladding", "dataset_subfolder": "Fluke_BrickCladding_2holes_0808_2025_noshutter"},
    "hardyboard_0813": {"material": "hardyboard", "dataset_subfolder": "Fluke_HardyBoard_08132025_2holes_noshutter"}
}

# --- Feature Engineering Parameters ---
# The full list of features to be calculated by generate_features.py
ALL_POSSIBLE_FEATURES = [
    'hotspot_area', 'hotspot_avg_temp_change_rate_initial', 'hotspot_avg_temp_change_magnitude_initial',
    'peak_pixel_temp_change_rate_initial', 'peak_pixel_temp_change_magnitude_initial', 'temp_mean_avg_initial',
    'temp_std_avg_initial', 'temp_min_overall_initial', 'temp_max_overall_initial',
    'stabilized_mean_deltaT', 'overall_mean_deltaT', 'max_abs_mean_deltaT',
    'stabilized_std_deltaT', 'overall_std_deltaT', 'mean_area_significant_change',
    'stabilized_area_significant_change', 'max_area_significant_change',
    'num_hotspots', 'hotspot_solidity', 'centroid_distance', 'time_to_peak_mean_temp',
    'temperature_skewness', 'temperature_kurtosis', 'rate_of_std_change_initial', 'peak_to_average_ratio',
    'radial_profile_0', 'radial_profile_1', 'radial_profile_2', 'radial_profile_3', 'radial_profile_4',
    'bbox_area', 'bbox_aspect_ratio'
]

SELECTED_FEATURES = [
    # Base Features
    'delta_T_log',
    'hotspot_area_log',
    'hotspot_avg_temp_change_rate_initial_norm',
    'temp_std_avg_initial',
    'temperature_kurtosis',
    # One-Hot Encoded Material Features
    'material_gypsum',
    'material_hardyboard',
    # Interaction Features
    'hotspot_area_log_x_gypsum',
    'hotspot_area_log_x_hardyboard',
    'temp_std_avg_initial_x_gypsum',
    'temp_std_avg_initial_x_hardyboard',
    'temperature_kurtosis_x_gypsum',
    'temperature_kurtosis_x_hardyboard',
    'hotspot_avg_temp_change_rate_initial_norm_x_gypsum',
    'hotspot_avg_temp_change_rate_initial_norm_x_hardyboard'
    
]
# Feature transformation flags used during feature generation
LOG_TRANSFORM_AREA = True
NORMALIZE_AVG_RATE_INITIAL = True
TRUE_FPS = 5
FOCUS_DURATION_SECONDS = 10

# --- Modeling and Evaluation Parameters ---
RANDOM_STATE = 42
HOLDOUT_SIZE = 0.2
CV_FOLDS = 5

# Advanced Modeling Flags
ENABLE_TARGET_SCALING = True
ENABLE_ASYMMETRIC_LOSS = False
ASYMMETRIC_LOSS_OVER_WEIGHT = 2.5

# Hyperparameter grids for tuning
PARAM_GRIDS = {
    # 'XGBoost': {
    #     'model__n_estimators': [100, 200],
    #     'model__max_depth': [3, 5, 7],
    #     'model__learning_rate': [0.05, 0.1],
    # },
    'RandomForest': {
        'model__n_estimators': [100, 200],
        'model__max_depth': [3, 5, None],
    },
    'SVR': {
        'model__C': [1, 10, 50],
        'model__epsilon': [0.01, 0.1, 0.2],
        'model__kernel': ['rbf'],
    },
    'MLPRegressor': {
        'model__hidden_layer_sizes': [(10,), (20,), (10, 10), (20, 10)], 
        'model__activation': ['relu', 'tanh'],
        'model__alpha': [0.1, 1.0, 5.0], # A wider range for regularization
        'model__learning_rate_init': [0.001, 0.01],
    }
}

